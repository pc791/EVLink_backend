<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.evlink.domain.notice.dao.NoticeDao">

  <!-- 목록 -->
  <select id="noticeList" resultType="noticevo">
    SELECT
      notice_id AS noticeId,
      title,
      content,
      DATE_FORMAT(notice_dt, '%Y-%m-%d') AS noticeDt,
      hit,
      major_yn AS majoryn,
      use_yn   AS useyn
    FROM tb_notice
    WHERE use_yn = 'Y'
    ORDER BY major_yn DESC, notice_id DESC
  </select>

  <!-- 필독 목록 -->
  <select id="majorNoticeList" resultType="noticevo">
    SELECT
      notice_id AS noticeId,
      title,
      content,
      DATE_FORMAT(notice_dt, '%Y-%m-%d') AS noticeDt,
      hit,
      major_yn AS majoryn,
      use_yn   AS useyn
    FROM tb_notice
    WHERE use_yn = 'Y' AND major_yn = 'Y'
    ORDER BY notice_id DESC
  </select>

  <!-- 상세 -->
  <select id="detail" parameterType="int" resultType="noticevo">
    SELECT
      notice_id AS noticeId,
      title,
      content,
      DATE_FORMAT(notice_dt, '%Y-%m-%d') AS noticeDt,
      hit,
      major_yn AS majoryn,
      use_yn   AS useyn
    FROM tb_notice
    WHERE notice_id = #{noticeId} AND use_yn = 'Y'
    LIMIT 1
  </select>


<!-- 조회수 증가 -->
<update id="updateHit" parameterType="int">
  UPDATE tb_notice
  SET hit = COALESCE(hit, 0) + 1
  WHERE notice_id = #{noticeId}
</update>

</mapper>
