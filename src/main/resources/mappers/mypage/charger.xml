<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.evlink.domain.mypage.dao.ChargerDao">
	<!-- 충전소 중복 등록 확인 -->
	<select id="checkChargerDuplicate" parameterType="charger" resultType="int">
		SELECT
		COUNT(*)
		FROM
		tb_private_charger
		WHERE
		user_id = #{userId}
	</select>
	
	<!-- 충전소정보 조회 -->
	<select id="getCharger" parameterType="long" resultType="charger">
	   SELECT charger_id as chargerId, user_id as userId, addr, addr_detail as addrDetail, charger_tel as chargerTel,
              charger_tp as chargerTp, charger_socket as chargerSocket, supply_power as supplyPower, operator, membership,
              open_time as openTime, close_time as closeTime, res_yn as resYn, pay_hour as payHour, pay_total as payTotal, remarks,
              (SELECT user_tp FROM tb_user WHERE user_id = #{userId}) as user_tp
	     FROM
	     tb_private_charger
         WHERE
         user_id = #{userId}
	</select>
	
	<insert id="addCharger" parameterType="charger">
		INSERT INTO tb_private_charger (user_id, addr, addr_detail, charger_tel, latitude, longitude, charger_tp, charger_socket, open_time, close_time, res_yn, pay_hour, pay_total, remarks, operator, membership, supply_power, safe_charger_tel, reg_dt)
		VALUES (#{userId}, #{addr}, #{addrDetail}, #{chargerTel}, #{latitude}, #{longitude}, #{chargerTp}, #{chargerSocket}, #{openTime}, #{closeTime}, "Y", #{payHour}, #{payTotal}, #{remarks}, #{operator}, #{membership}, #{supplyPower}, #{safeChargerTel}, sysdate())
	</insert>

	<update id="updateCharger" parameterType="charger"> 
	    UPDATE tb_private_charger
	    <set>
			<if test="latitude != null">latitude = #{latitude},</if>
			<if test="longitude != null">longitude = #{longitude},</if>
			<if test="chargerTp != null">charger_tp = #{chargerTp},</if>
			<if test="addr != null">addr = #{addr},</if>
			<if test="addrDetail != null">addr_detail = #{addrDetail},</if>
			<if test="chargerSocket != null">charger_socket = #{chargerSocket},</if>
			<if test="openTime != null">open_time = #{openTime},</if>
			<if test="closeTime != null">close_time = #{closeTime},</if>
			<if test="resYn != null">res_yn = #{resYn},</if>
			<if test="chargerTel != null">charger_tel = #{chargerTel},</if>
			<if test="payHour != null">pay_hour = #{payHour},</if>
			<if test="payTotal != null">pay_total = #{payTotal},</if>
			<if test="remarks != null">remarks = #{remarks},</if>
			<if test="operator != null">operator = #{operator},</if>
			<if test="membership != null">membership = #{membership},</if>
			<if test="supplyPower != null">supply_power = #{supplyPower}</if>
			upd_dt = sysdate()
		</set>
		WHERE charger_id = #{chargerId} 
	</update>

	<delete id="deleteCharger" parameterType="long">
		DELETE FROM tb_private_charger WHERE charger_id = #{chargerId}
	</delete>
	
	<!-- 예약시 충전소 정보 가져오기 -->
    <select id="getChargerById" parameterType="long" resultType="charger">
		SELECT
		addr,
		addr_detail AS addrDetail,
		open_time AS openTime,
		close_time AS closeTime,
		res_yn AS resYn,
		pay_hour AS payHour,
		pay_total AS payTotal
		FROM
		tb_private_charger
		WHERE
		charger_id = #{chargerId}
    </select>
    
    <!-- 프론트 마커 뿌리기용 충전소 조회 -->
	<select id="getAllChargers" resultType="charger">
		SELECT
		charger_id AS chargerId,
		user_id AS userId,
		addr,
		addr_detail AS addrDetail,
		latitude,
        longitude, 
		charger_tp AS chargerTp,
		charger_socket AS chargerSocket,
		open_time AS openTime,
		close_time AS closeTime,
		res_yn AS resYn,
		pay_total AS payTotal,
		remarks,
		safe_charger_tel AS safeChargerTel
		FROM
		tb_private_charger
	</select>

    <select id="callUserTpUpdate" statementType="CALLABLE" parameterType="charger">
        {call UPDATE_USER_TP(#{userId, mode=IN, jdbcType=BIGINT})}
    </select>
</mapper>