<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.evlink.domain.login.dao.PasswordLessLoginDao">
    <!-- Login Check -->
    <select id="checkPassword" parameterType="plUserInfo" resultType="plUserInfo">
        SELECT login_id, login_pw, join_type, reg_dt, user_tp
        FROM tb_user
        WHERE login_id = #{login_id}
          AND login_pw = CASE WHEN INSTR(login_pw, login_id) > 0 THEN
                            login_pw
                         ELSE
                            sha(#{login_pw})
                         END
          AND join_type = '001'
    </select>

    <!-- Search for User Information -->
    <select id="getUserInfo" parameterType="plUserInfo" resultType="plUserInfo">
        SELECT login_id, login_pw, join_type, reg_dt, user_tp
        FROM tb_user
        WHERE login_id = #{login_id}
          AND join_type = '001'
    </select>
    
    <!-- Password Update -->
    <update id="updatePassword">
        UPDATE tb_user
        SET login_pw=sha(#{login_pw})
        WHERE login_id = #{login_id}
          AND join_type = '001'
    </update>
    
    <!-- User Registration -->
    <insert id="createUserInfo">
        INSERT INTO tb_user (login_id, login_pw, user_tp, join_type, reg_dt, reg_user)
        VALUES(#{login_id}, sha(#{login_pw}), "USR005", "001", sysdate(), #{login_id})
    </insert>
    
    <!-- User Deletion -->
    <delete id="withdrawUserInfo">
        DELETE FROM tb_user
        WHERE login_id = #{login_id}
          AND join_type = '001'
    </delete>

    <!-- Password Change -->
    <update id="changepw">
        UPDATE tb_user
        SET login_pw = #{login_pw}
        WHERE login_id = #{login_id}
          AND join_type = '001'
    </update>
    
    <!-- Update User Type -->
    <update id="updateUserType">
        UPDATE tb_user
           SET user_tp = #{user_tp}
         WHERE login_id = #{login_id}
           AND join_type = '001'
    </update>
    
</mapper>